<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Causal Compiler v4.7</title>

<style>
body{
    background:#050b18;
    color:#9fb3ff;
    font-family:monospace;
    padding:20px;
}
textarea{
    width:100%;
    height:120px;
    background:#0d162b;
    color:#fff;
    border:1px solid #1f2a44;
    padding:10px;
    font-size:16px;
}
button{
    margin-top:10px;
    padding:10px 20px;
    background:#1f2a44;
    color:#9fb3ff;
    border:none;
    cursor:pointer;
}
.output{
    margin-top:20px;
    padding:15px;
    background:#0d162b;
    border:1px solid #1f2a44;
    white-space:pre-wrap;
}
</style>
</head>

<body>

<h2>CAUSAL COMPILER v4.7</h2>

<textarea id="inputText" placeholder="Enter English sentence..."></textarea>
<button onclick="compileText()">Compile</button>

<div class="output" id="outputBox"></div>

<script type="module">

import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

const API_KEY = "PUT_YOUR_API_KEY_HERE"; 
const genAI = new GoogleGenerativeAI(API_KEY);

async function compileText(){

    const input = document.getElementById("inputText").value;
    const outputBox = document.getElementById("outputBox");
    outputBox.textContent = "Processing...";

    try{

        const model = genAI.getGenerativeModel({
            model: "gemini-2.5-flash"
        });

        const prompt = `
You MUST respond ONLY in valid JSON format.

Return this structure:

{
  "causal_language": "converted sentence"
}

Convert this sentence into causal language:
"${input}"
`;

        const result = await model.generateContent({
            contents: [{ role: "user", parts: [{ text: prompt }] }],
            generationConfig: {
                responseMimeType: "application/json"
            }
        });

        const responseText = result.response.text();

        let parsed;

        try {
            parsed = JSON.parse(responseText);
        } catch (e) {

            // اگر متن اضافی بود JSON را استخراج می‌کنیم
            const match = responseText.match(/\{[\s\S]*\}/);
            if(match){
                parsed = JSON.parse(match[0]);
            } else {
                throw new Error("Model did not return valid JSON.");
            }
        }

        outputBox.textContent = parsed.causal_language;

    }catch(error){
        console.error(error);
        outputBox.textContent = "Error: " + error.message;
    }
}

window.compileText = compileText;

</script>

</body>
</html>
